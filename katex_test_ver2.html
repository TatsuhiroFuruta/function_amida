<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <!-- html2canvasライブラリを追加 -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
    <canvas id="myCanvas" width="800" height="600" style="border: 1px solid #000;"></canvas>
    
    <script>
        async function renderKatexToCanvas(latexString, x, y) {
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');
            
            // 一時的なコンテナを作成
            const tempDiv = document.createElement('div');
            tempDiv.style.position = 'absolute';
            // tempDiv.style.left = '-9999px';
            // tempDiv.style.top = '0px';
            // tempDiv.style.background = 'white';
            tempDiv.style.padding = '10px';
            document.body.appendChild(tempDiv);
            
            try {
                // KaTeXで数式をレンダリング
                katex.render(latexString, tempDiv, {
                    throwOnError: false,
                    displayMode: true
                });
                
                // html2canvasを使ってcanvasに描画
                const canvasElement = await html2canvas(tempDiv, {
                    backgroundColor: 'white',
                    scale: 2
                });
                
                // 生成されたcanvasをメインcanvasに描画
                ctx.drawImage(canvasElement, x, y);
                
            } catch (error) {
                console.error('レンダリングエラー:', error);
            } finally {
                // 一時要素を削除
                document.body.removeChild(tempDiv);
            }
        }
        
        // 使用例
        renderKatexToCanvas('E = mc^2', 50, 50);
        renderKatexToCanvas('\\frac{a}{b} = \\frac{c}{d}', 50, 150);
    </script>
</body>
</html>