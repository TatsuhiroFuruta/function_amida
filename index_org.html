<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>あみだくじ</title>
  <style>
    body { text-align: center; font-family: sans-serif; }
    canvas { border: 1px solid #333; margin-top: 10px; }
    .buttons { margin: 10px; }
  </style>
</head>
<body>
  <h1>あみだくじ</h1>
  <div class="buttons">
    <button onclick="startGame(0)">スタート 1</button>
    <button onclick="startGame(1)">スタート 2</button>
    <button onclick="startGame(2)">スタート 3</button>
  </div>
  <canvas id="amida" width="400" height="400"></canvas>
  <p id="result"></p>

  <script>
    const canvas = document.getElementById("amida");
    const ctx = canvas.getContext("2d");
    const lineCount = 3; // 縦線の数
    const topY = 20;
    const bottomY = 380;
    const spacing = canvas.width / (lineCount + 1);

    // 横線をランダム生成
    const horizontalLines = [];
    for (let y = 60; y < bottomY - 20; y += 40) {
      if (Math.random() < 0.5) {
        const xIndex = Math.floor(Math.random() * (lineCount - 1));
        console.log(xIndex);
        horizontalLines.push({ y, from: xIndex, to: xIndex + 1 });
      }
    }

    // あみだくじ描画
    function drawAmida() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = "black";
      ctx.lineWidth = 2;

      // 縦線
      for (let i = 0; i < lineCount; i++) {
        const x = spacing * (i + 1);
        ctx.beginPath();
        ctx.moveTo(x, topY);
        ctx.lineTo(x, bottomY);
        ctx.stroke();
      }

      // 横線
      horizontalLines.forEach(line => {
        const x1 = spacing * (line.from + 1);
        const x2 = spacing * (line.to + 1);
        ctx.beginPath();
        ctx.moveTo(x1, line.y);
        ctx.lineTo(x2, line.y);
        ctx.stroke();
      });
    }

    // ゴール結果（例）
    const results = ["A賞", "B賞", "C賞"];

    // スタートしてゴールまでたどる
    function startGame(startIndex) {
      let xIndex = startIndex;
      let y = topY;

      function step() {
        if (y >= bottomY) {
          document.getElementById("result").textContent =
            `スタート${startIndex + 1} → ゴール: ${results[xIndex]}`;
          return;
        }

        // 横線があるか確認
        const line = horizontalLines.find(l => l.y === y && (l.from === xIndex || l.to === xIndex));
        if (line) {
          if (line.from === xIndex) {
            xIndex = line.to;
          } else {
            xIndex = line.from;
          }
        }

        // 描画
        drawAmida();
        ctx.fillStyle = "red";
        ctx.beginPath();
        ctx.arc(spacing * (xIndex + 1), y, 5, 0, Math.PI * 2);
        ctx.fill();

        y += 5;
        requestAnimationFrame(step);
      }
      step();
    }

    drawAmida();
  </script>
</body>
</html>
