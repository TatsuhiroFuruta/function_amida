<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>指数関数の曲線上を往復するボール</title>
<style>
  canvas {
    border: 1px solid #ccc;
  }
</style>
</head>
<body>
<h2>y = e^x の曲線上をボールが往復する</h2>
<canvas id="graph" width="500" height="400"></canvas>

<script>
const canvas = document.getElementById('graph');
const ctx = canvas.getContext('2d');

const width = canvas.width;
const height = canvas.height;

const xMin = -2;
const xMax = 2;
const yMin = 0;
const yMax = Math.exp(xMax);

function toCanvasX(x) {
  return (x - xMin) / (xMax - xMin) * width;
}
function toCanvasY(y) {
  return height - (y - yMin) / (yMax - yMin) * height;
}

// 曲線の座標配列
const points = [];
for (let x = xMin; x <= xMax; x += 0.01) {
  const y = Math.exp(x);
  points.push({x: toCanvasX(x), y: toCanvasY(y)});
}

let idx = 0;   // 現在のインデックス
let dir = 1;   // 1:順方向 -1:逆方向

function draw() {
  ctx.clearRect(0, 0, width, height);

  // 座標軸
  ctx.strokeStyle = '#000';
  ctx.beginPath();
  ctx.moveTo(0, toCanvasY(0));
  ctx.lineTo(width, toCanvasY(0));
  ctx.moveTo(toCanvasX(0), 0);
  ctx.lineTo(toCanvasX(0), height);
  ctx.stroke();

  // 曲線
  ctx.strokeStyle = 'blue';
  ctx.beginPath();
  ctx.moveTo(points[0].x, points[0].y);
  for (let i = 1; i < points.length; i++) {
    ctx.lineTo(points[i].x, points[i].y);
  }
  ctx.stroke();

  // ボール
  const p = points[idx];
  ctx.beginPath();
  ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
  ctx.fillStyle = 'red';
  ctx.fill();

  // 次のインデックス
  idx += dir;
  // 端に来たら逆方向に
  if (idx >= points.length - 1) {
    idx = points.length - 1;
    dir = -1;
  } else if (idx <= 0) {
    idx = 0;
    dir = 1;
  }

  requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
